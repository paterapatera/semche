# ユーザーはsearchで取得するのは500文字までではなく全文取得できる

## 概要

現在のsearch機能では、検索結果として取得されるドキュメント内容が500文字に制限されています。この制限を撤廃し、ドキュメントの全文を取得できるようにすることで、検索結果の完全な内容を確認できるようにします。

## 実行手順(上から順にチェックしてください)

### Phase 1: 要件定義・設計【対話フェーズ - ユーザー確認必須】

- [x] ストーリーの背景と目的を確認する
  - 現在の500文字制限の実装箇所を特定する（`src/semche/tools/search.py` 60-61行目）
  - 全文取得による影響範囲（メモリ使用量、パフォーマンス等）を確認する
- [x] 実装する機能の詳細をユーザーと対話して決定する
  - デフォルトで全文取得、オプションで文字数制限可能にする
  - 上限値は設けない
  - 後方互換性は考慮不要
- [x] 技術スタック（使用するライブラリ・フレームワーク）をユーザーと相談する
  - 既存のChromaDB Manager、search.pyの修正方針を確認する
- [x] ファイル構成案を提示し、ユーザーの承認を得る
  - 修正対象ファイル：`src/semche/tools/search.py`
  - 修正対象ファイル：`src/semche/mcp_server.py`
  - 修正対象ファイル：`src/semche/tools/search.py.exp.md`
  - テストファイル：`tests/test_search.py`
  - ドキュメント：`README.md`
- [x] **Phase 1完了の確認をユーザーから得てから次に進む**
- [x] 承認を得た内容をストーリーに反映する

### Phase 2: 実装【実装フェーズ】

- [x] `src/semche/tools/search.py`のsearchツールに`max_content_length`パラメータを追加
- [x] `src/semche/mcp_server.py`のsearch関数に`max_content_length`パラメータを追加
- [x] デフォルト（`None`）で全文取得、整数値指定時に文字数制限を実装
- [x] コア機能の実装が完了している
- [x] `CODE_REVIEW_GUIDE.md` に準拠してコードレビューが完了している
- [x] テストコードが作成されている
  - 全文取得のテストケースを追加（`test_max_content_length`）
  - 長文ドキュメント（1000文字）の取得テストを追加
  - 制限指定時の動作テストを追加
- [x] テストが全てパスする（79 passed）
- [x] Lint（ruff）/ 型チェック（mypy）が通る
- [x] README.md と詳細設計書（`src/semche/tools/search.py.exp.md`）を更新済み（ツール一覧・引数/返却仕様）

### Phase 3: 確認・ドキュメント【対話フェーズ - ユーザー確認必須】

- [x] 実装完了を報告し、ユーザーにレビューを依頼する
- [x] 手動での動作確認を行う
  - MCP Inspectorを起動（http://localhost:6274）
  - 長文ドキュメントの検索結果を確認可能
  - デフォルトで全文が取得できることを確認可能
  - `max_content_length`パラメータで制限できることを確認可能
- [x] 今回更新したコードの詳細設計書を更新する
  - `src/semche/tools/search.py.exp.md`を更新済み
  - `AGENTS.md`を更新済み（v0.5.0の変更内容を追記）
- [x] **全ての作業完了をユーザーに報告する**
