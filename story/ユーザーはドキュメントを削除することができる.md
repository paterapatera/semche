# ユーザーはドキュメントを削除することができる

## 概要

MCPツールを通じて、ChromaDBに保存されたドキュメントを削除できる機能を実装します。ファイルパス（ID）を指定して単一のドキュメントを削除します（本ストーリーでは単一削除のみを対象とします）。

## 実行手順(上から順にチェックしてください)

### Phase 1: 要件定義・設計【対話フェーズ - ユーザー確認必須】

- [x] ストーリーの背景と目的を確認する
- [x] 実装する機能の詳細をユーザーと対話して決定する
  - 削除方式: 単一削除のみ
  - エラーハンドリング方針: 存在しないIDはエラーではなく警告扱い（`deleted_count: 0`）
  - 返却値の形式: 以下の通り
    - 成功（削除あり）: `{status: "success", message: "ドキュメントを削除しました", deleted_count: 1, filepath}`
    - 成功（該当なし）: `{status: "success", message: "削除対象が見つかりませんでした", deleted_count: 0, filepath}`
    - 失敗: `{status: "error", message, error_type}`
- [x] 技術スタック（使用するライブラリ・フレームワーク）をユーザーと相談する
  - ChromaDBの`collection.delete(ids=[...])`を使用
  - `chromadb_manager.delete()`を追加し、MCPツール`delete_document`から呼び出し
- [x] ファイル構成案を提示し、ユーザーの承認を得る
  - `src/semche/tools/delete.py` の作成
  - `src/semche/mcp_server.py` への登録
  - テストファイルの配置（`tests/test_delete.py`）
- [x] **Phase 1完了の確認をユーザーから得てから次に進む**
- [x] 承認を得た内容をストーリーに反映する

### Phase 2: 実装【実装フェーズ】

- [ ] `src/semche/tools/delete.py` を作成
  - `delete_document()` 関数の実装
  - 入力バリデーション（filepath/IDの検証）
  - ChromaDBManagerのdelete機能の実装または利用
  - エラーハンドリング
- [ ] `src/semche/chromadb_manager.py` にdelete機能を追加（必要に応じて）
  - `delete()` メソッドの実装
  - 存在確認ロジック
- [ ] `src/semche/mcp_server.py` にツールを登録
  - `@mcp.tool()` デコレータでdelete_documentを公開
- [ ] `CODE_REVIEW_GUIDE.md` に準拠してコードレビューが完了している
- [ ] テストコードが作成されている
  - `tests/test_delete.py` の作成
  - 正常系: 単一削除、複数削除
  - 異常系: 存在しないID、空のID、不正な入力
- [ ] テストが全てパスする
- [ ] Lint/Typecheckが通る（ruff, mypy）

### Phase 3: 確認・ドキュメント【対話フェーズ - ユーザー確認必須】

- [ ] 実装完了を報告し、ユーザーにレビューを依頼する
- [ ] 手動での動作確認を行う
  - MCP Inspectorでの動作テスト
  - 実際のドキュメント削除の確認
- [ ] 今回更新したコードの詳細設計書を作成・更新する
  - `src/semche/tools/delete.py.exp.md`
  - `src/semche/chromadb_manager.py.exp.md` の更新（必要に応じて）
- [ ] README.mdのツール一覧を更新
  - `delete_document` ツールの説明を追加
  - パラメータ・返却値の記載
- [ ] **全ての作業完了をユーザーに報告する**
